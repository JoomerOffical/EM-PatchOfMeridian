<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
<!--  -->
	<trigger	Name="GlobalVar"	active="1">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("StarievshikDie", 0)
			SetVar("PlemmanikStat", 0)

		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trStartMap"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
		    	trigger:Deactivate()

			SetTolerance(1100, 1112, RS_ALLY)

--			CreateNewDummyObject("lamppost2","MayakBr",-1,-1,CVector(956.093,302.85,3105.383),Quaternion(0.002,0.044,0.168,0.985),0)

-- TEST !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
			TakeQuest("r5m2_FindHollywood_Quest")
-- TEST !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

		    	if QuestStatus("r5m2_FHMoveMapTwo_Quest")==Q_TAKEN then
		    		CompleteQuest("r5m2_FHMoveMapTwo_Quest")
			end

			setPos("boss1Arm1", CVector(0, 0, 0))

			CreateNewDummyObject("boss01_static", "bossarm1",-1,-1,CVector(1420.050,264.124,2956.899),Quaternion(0.000,-0.513,0.000,0.858),0)

			CreateNewDummyObject("car_cemetery07","GateCar1",-1,-1,CVector(1419.080,258.000,3011.649),Quaternion(0.000,0.4559,0.000,0.890),0)
			CreateNewDummyObject("car_cemetery07","GateCar2",-1,-1,CVector(1612.937,250.000,3020.809),Quaternion(0.000,0.0741,0.00,0.9973),0)
		</script>
	</trigger>





<!-- после 62 -->
	<trigger	Name="trStartMapAfter62"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
		    	if IsQuestComplete("r6m1_HelpShip_Quest") then
		    		trigger:Deactivate()

				GetEntityByName("ToR6M2"):SetProperty("Active",1)

				CreateNewDummyObject("ferry_work","PLOT",-1,-1,CVector(834.120,215,3344.586),Quaternion(0.0000,-0.8351,0.0000,0.5501),0)
			end
		</script>
	</trigger>





<!-- Если включен маяк -->
	<trigger	Name="trStartMapMayak"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
		    	if IsQuestComplete("r5m2_StartMayak_Quest") then
				getObj("Mayak"):SetNodeAction(AT_MOVE1)
				getObj("Mayak_motor"):SetNodeAction(AT_MOVE1)
			end
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trStarievshik"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Starievshik_loc" />
		<script>
			if QuestStatus("r5m2_FHTalkWithAnticwar_Quest")==Q_TAKEN then
				trigger:Deactivate()

			    	StartConversation("Starievshik_NPC")
			end
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trCreateStarievshik"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
		    trigger:Deactivate()
		    CreateTeam("Starievshik", 1105, CVector(getPos("Starievshik_loc")), {"Star_car"}, nil, nil, nil)
		    TActivate("trStarievshikDie")
		</script>
	</trigger>





<!--  -->
	<trigger Name="trStarievshikDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Starievshik" />
		<script>
			trigger:Deactivate()
			SetVar("StarievshikDie", 1)
			CompleteQuest("r5m2_FHDeleteSled_Quest")
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trBattleWithIten"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="BattleWithIten_loc" />
		<script>
			if QuestStatus("r5m2_KillWantedBandit_Quest")==Q_CANBEGIVEN then
				trigger:Deactivate()

				TakeQuest("r5m2_KillWantedBandit_Quest")

				TActivate("cinIten")
		    end
		</script>
	</trigger>





<!--  -->
	<trigger Name="trItenDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Iten" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_KillWantedBandit_Quest")

            TActivate("trItenDie2")
		</script>
	</trigger>

	<trigger Name="trItenDie2" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="AfterItenDie_loc" />
		<script>
			trigger:Deactivate()

			TActivate("cinAfterItenDie")
		</script>
	</trigger>


<!--  -->
	<trigger	Name="trCreateAmerigoTeam"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
		    	trigger:Deactivate()

			SetTolerance(1105, 1112, RS_ENEMY)
			SetTolerance(1106, 1112, RS_ENEMY)

			local amteam = CreateCaravanTeam("AmerigoTeam", 1112, {CVector(getPos("SpawnCaptain_loc")),CVector(getPos("SpawnSoldier1_loc"))}, {"Amerigo_car","Patr_car"}, nil, nil, Quaternion(0.036, -0.661, 0.038, 0.748))
		    	if amteam then
		    		TakeQuest("r5m2_DestroyKrot_Quest")

			    	for i=0,1 do
			    		veh=amteam:GetVehicle(i)
			    		if veh then
						veh:setImmortalMode(1)
						veh:SetReactingOnDisturbingVehicles(false)
					end
				end

				SetVar("AmerigoMaxPoint",4)
				SetVar("AmerigoCurPoint",1)

				SetVar("AmerigoVehicles", 2)

				local maxpoint = GetVar("AmerigoMaxPoint").AsInt
				for i=1,maxpoint do
					SetVar("AmerigoPoint"..i,0)
				end

				TakeQuest("r5m2_KrotInOneeye_Quest")

				TActivate("trNearAmergoStart")
			else
				LOG("TRIGGER ERROR: Can't create AmerigoTeam")
			end

		</script>
	</trigger>

	<trigger	Name="trNearAmergoStart"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearAmerigoStart_loc" />
		<script>
			trigger:Deactivate()

			for i=0,1 do
				local veh = getObj("AmerigoTeam_vehicle_"..i)
				if veh then
					veh:SetCruisingSpeed(70)
					veh:SetExternalPathByName("Amerigo"..(i+1).."_1_ExPath")
				end
			end

			TActivate("trAmerigoMove")
			TActivate("trAmerigoTeamPoint")
		</script>
	</trigger>

	<trigger	Name="trAmerigoMove"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
			for i=0,1 do
				local veh = getObj("AmerigoTeam_vehicle_"..i)
				if veh then
					local rast = Dist(veh,GetPlayerVehicle())
					if rast>=70 then
						veh:SetThrottle( 0 )
						veh:SetCustomLinearVelocity( 0 )
					end
				end
			end
		</script>
	</trigger>

<!--  -->
	<trigger	Name="trAmerigoTeamPoint"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="AmerigoTeam_vehicle_0"/>
		<event eventid="GE_TARGET_REACHED" ObjName="AmerigoTeam_vehicle_1"/>
		<script>
			local maxpoint = GetVar("AmerigoMaxPoint").AsInt
			local point = GetVar("AmerigoCurPoint").AsInt
			local stat 	= GetVar("AmerigoPoint"..point).AsInt+1
			
			SetVar("AmerigoPoint"..point, stat)
			
			if stat>=2 then
				point = point+1

				SetVar("AmerigoCurPoint",point)

				local amteam = getObj("AmerigoTeam")
				if amteam then
					for i=0,1 do
				    		local veh = getObj("AmerigoTeam_vehicle_"..i)
				    		if veh then
							veh:SetExternalPathByName("Amerigo"..(i+1).."_"..point.."_ExPath")
						end
					end
				end

				if point>maxpoint then
					trigger:Deactivate()

					TDeactivate("trAmerigoMove")
					TActivate("trWaitHeroofAmergo")
				end
			end
		</script>
	</trigger>

	<trigger	Name="trWaitHeroofAmergo"	active="0">
		<event	timeout="1"	eventid="GE_TIME_PERIOD" />
		<script>
			local veh = getObj("AmerigoTeam_vehicle_1")
			if veh then
				local rast = Dist(veh,GetPlayerVehicle())
				if 100 >= rast then
			trigger:Deactivate()

			TActivate("trCreateBanditsTeam")
				end
			end
		</script>
	</trigger>




<!--  -->
	<trigger	Name="trCreateBanditsTeam"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			SetTolerance(1105, 1112, RS_NEUTRAL)

			local listofpos = {CVector(getPos("SpawnBandit1_loc")),CVector(getPos("SpawnBandit2_loc")),CVector(getPos("SpawnBandit3_loc"))}

			local btteam = CreateTeam("BanditsTeam", 1105, listofpos, {"r1m1_sml04","Scout02","r1m1_sml03"}, CVector(getPos("BattleWithBandits_loc")), nil, Quaternion(0.036, -0.661, 0.038, 0.748))

			if btteam then
				SetVar("CountBanditsDie",0)

				TActivate("trBanditsVehDie")
			else
				LOG("TRIGGER ERROR: Can't create BanditsTeam")
			end
		</script>
	</trigger>

<!--  -->
	<trigger Name="trBanditsVehDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="BanditsTeam_vehicle_0" />
		<event eventid="GE_OBJECT_DIE" ObjName="BanditsTeam_vehicle_1" />
		<event eventid="GE_OBJECT_DIE" ObjName="BanditsTeam_vehicle_2" />
		<script>
			local stat = GetVar("CountBanditsDie").AsInt+1

			SetVar("CountBanditsDie",stat)

			if stat>=2 then
				trigger:Deactivate()

				local teamID = CreateNewObject{
					prototypeName = "team",
					objName = "AmerigoTeam_2",
					belong = 1105
				}
				local teamnew=GetEntityByID(teamID)
				local teamold = getObj("AmerigoTeam")

				if teamold then
					for i=0,1 do
						local veh = getObj("AmerigoTeam_vehicle_"..i)
						if veh then
							veh:AddModifier( "hp", "+ 1000000" )
							local cab = veh:GetCabin()
							if cab then
								cab:AddModifier( "dur", "+ 1000000" )
							end	
							local basket = veh:GetBasket()
							if basket then
								basket:AddModifier( "dur", "+ 1000000" )
							end	

							veh:setImmortalMode(0)

							teamnew:AddChild(veh)

						end
					end	
				end

				SetVar("CountBanditsDie",0)

				CompleteQuest("r5m2_KIOMoveWithCaravan_Quest")

				TActivate("cinBandits1")
				TActivate("trBanditsTeamDie")
			end
		</script>
	</trigger>




<!--  -->
	<trigger Name="trBanditsTeamDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="BanditsTeam" />
		<event eventid="GE_OBJECT_DIE" ObjName="AmerigoTeam_2" />
		<script>
			local stat = GetVar("CountBanditsDie").AsInt+1

			SetTolerance(1112, 1100, RS_ALLY)
			SetTolerance(1105, 1112, RS_ENEMY)

			SetVar("CountBanditsDie",stat)

			if stat>=2 then
				trigger:Deactivate()

				CompleteQuest("r5m2_KIOKillKrotBand_Quest")

				TActivate("cinAfterBandits")
				TActivate("trCreateBanditsOnBase")
			end
		</script>
	</trigger>




<!--  -->
	<trigger	Name="trCreateBanditsOnBase"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
		    	trigger:Deactivate()

		    	local btteam = CreateTeam("BanditsBaseTeam", 1105, CVector(getPos("SpawnVeter_loc")), {"Fighter02","Fighter01","Scout01"}, nil, nil, Quaternion(0.036, -0.661, 0.038, 0.748))

		    	if btteam then
			    	TActivate("trEnterBanditsBase")

			    	for i=0,2 do
					veh=btteam:GetVehicle(i)
			    		if veh then
						veh:setGodMode(1)
					end
			    	end
			else
				LOG("TRIGGER ERROR: Can't create BanditsBaseTeam")
			end

		</script>
	</trigger>




<!--  -->
	<trigger	Name="trEnterBanditsBase"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="BanditBase_loc" />
		<script>
			trigger:Deactivate()

			local btteam=getObj("BanditsBaseTeam")
		   	if btteam then
			    	for i=0,2 do
					veh=btteam:GetVehicle(i)
			    		if veh then
						veh:setGodMode(0)
					end
			   	 end
			    	TActivate("trBanditsBaseTeamDie")
			end
		</script>
	</trigger>




<!--  -->
	<trigger Name="trBanditsBaseTeamDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="BanditsBaseTeam" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_DestroyKrot_Quest")

			SetTolerance(1100, 1108, RS_ALLY)
			SetTolerance(1105, 1108, RS_ALLY)
			SetTolerance(1106, 1108, RS_ALLY)

			TActivate("cinFindVeter")
		</script>
	</trigger>

<!--  -->
	<trigger	Name="trStartVeterByPath"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
		    trigger:Deactivate()

		    local veterteam = getObj("VeterTeam")
		    if veterteam then
			local veh=veterteam:GetVehicle(0)
		    	if veh then
				veh:SetExternalPathByName("Veter_ExPath")
				veh:SetCruisingSpeed(120)
				veh:SetReactingOnDisturbingVehicles(false)

				TActivate("trVeterReachPoint")
				TActivate("trVeterMoveLoc")
		    	end
		    else
		    	LOG("TRIGGER ERROR: Can't find VeterTeam")
		    end

		    for i=1,2 do
				local gateboss = getObj("GateCar"..i)
				if gateboss then
					gateboss:Remove()
				end
			end
		</script>
	</trigger>

	<trigger	Name="trVeterMoveLoc"	active="0">
		<event	timeout="0.5"		eventid="GE_TIME_PERIOD" />
		<script>
			local rast = Dist(getObj("VeterTeam_vehicle_0"),GetPlayerVehicle())
			if rast>=150 then
				local veter = getObj("VeterTeam_vehicle_0")
				if veter then
					veter:SetThrottle( 0 )
					veter:SetCustomLinearVelocity( 0 )
				end
			end
		</script>
	</trigger>

<!--  -->
	<trigger	Name="trVeterReachPoint"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="VeterTeam_vehicle_0"/>
		<script>
			trigger:Deactivate()

			PlayRadioSoundById(1001)

			CompleteQuest("r5m2_MoveToMayak_Quest")

		    	local m = getObj("MayakBr")
			if m then m:Remove() end

			CreateNewObject{prototypeName = "lamppost2",objName = "MayakBr1",belong = 1001}
			getObj("MayakBr1"):SetRotation(Quaternion(0.002,0.044,0.168,0.985))
			getObj("MayakBr1"):SetPosition(CVector(956.093,302.85,3105.383))

			TActivate("trNeedOnMayak")
			TDeactivate("trVeterMoveLoc")
		</script>
	</trigger>

<!--  Ветер гибнет -->
	<trigger	Name="trVeterDie"	active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="VeterTeam" />
		<script>
			trigger:Deactivate()

			SpawnMessageBox(8802)
			ShowDeathMenu()
		</script>
	</trigger>



<!--  -->
	<trigger	Name="trNeedOnMayak"	active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="MayakBr1" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_StartMayak_Quest")

			TActivate("cinMayakOn")
			TDeactivate("trVeterDie")
		</script>
	</trigger>




<!--  -->
	<trigger Name="trRobot1TeamDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Robot1Team" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_KillRobotsAtMayak_Quest")

		    TActivate("trMoveToBoss")
			TActivate("DestroyPervomayka")
		</script>
	</trigger>


	<trigger Name="DestroyPervomayka" active="0">
		<event 	timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local town = GetEntityByName ("r5m2_Pervomayka")
			if town then
				town:SetOpenGateToPlayer(false)
				town:SetRuined(true)
			end

			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(3086.179, 244.346, 2920.394), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(3141.996, 242.574, 2943.549), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(2996.716, 243.763, 2955.587), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(3010.558, 250.317, 2896.269), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(3037.749, 244.544, 2999.308), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(3132.209, 240.538, 3007.177), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(3137.504, 240.407, 3025.329), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(3154.654, 241.254, 3037.010), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))															

			getObj("staticAutoGun028267"):AddModifier("hp","= -10000")
			getObj("staticAutoGun028268"):AddModifier("hp","= -10000")
			getObj("brick_dot1_vulcan5654"):AddModifier("hp","= -10000")
			getObj("brick_dot2_vulcan5655"):AddModifier("hp","= -10000")

			trigger:Deactivate()    
		</script>
	</trigger>


<!--  -->
	<trigger	Name="trMoveToBoss"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="BossBattle_loc" />
		<script>
			trigger:Deactivate()

			AllowSave(false)

			TakeQuest("r5m2_KillBoss1_Quest")

			SetTolerance(1100,1105,RS_NEUTRAL)
			SetTolerance(1100,1106,RS_NEUTRAL)

			TActivate("cinBoss")
			TActivate("trBoss1Die")
		</script>
	</trigger>




<!--  -->
	<trigger Name="trBoss1Die" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="boss1Arm1" />
		<script>
			trigger:Deactivate()

			AllowSave(true)

			CompleteQuest("r5m2_KillBoss1_Quest")

			SetTolerance(1100,1105,RS_ENEMY)
			SetTolerance(1100,1106,RS_ENEMY)

			for i=1,2 do
				local gateboss = getObj("GateCar"..i)
				if gateboss then
					gateboss:Remove()
				end
			end

            getObj("OneEye_Dot1"):AddModifier("hp","= -100")
			getObj("OneEye_Dot4"):AddModifier("hp","= -100")
			getObj("OneEye_Dot6"):AddModifier("hp","= -100")
			getObj("OneEye_Dot5"):AddModifier("hp","= -100")

			AllowInfectionZoneGeneration( 1 )

			GetEntityByName("TheOneEyeBase_enter"):SetProperty("Active",0)

			StopPlayingCustomMusic()

			CreateTeam("RobotAfterBoss1Team", 1118, CVector(2215.958, 287.258, 2849.179), {"Robot4SMALL"}, nil, nil, nil)
			CreateTeam("RobotAfterBoss2Team", 1118, CVector(2734.563, 280.151, 2612.826), {"Robot4_2SMALL"}, nil, nil, nil)
			CreateTeam("RobotAfterBoss3Team", 1118, CVector(3042.057, 220.510, 1778.021), {"Robot4SMALL"}, nil, nil, nil)
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trReturnToBase"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="TheOneEyeBase_loc" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_ReturnToOneeyeAfterM_Quest")

	        TActivate("cinReturnToBase")
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trStartRobotsAttack"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			CreateTeam("GuardTeam",1112,CVector(3393.879, 223.929, 2031.251),{"Scout02", "Fighter02"})
			CreateTeam("GuardTeam",1112,CVector(3615.844, 258.949, 1956.626),{"Scout03", "Molokovoz02"})

			AllowSave(false)

			SetVar("RobotsCount",0)

			TActivate("trRobotEntersBase")
			TActivate("trSpawnRobotsAttack")

			local dotp = getObj("DotForPlayer")
			local pos
			local rot

			if dotp then
				pos = dotp:GetPosition()
				rot = dotp:GetRotation()

				dotp:SetPosition( CVector(0, 0, 0) )
			end

			local dotpnew = CreateVehicleEx ( "Dot01", "PlayerDot", pos, "PlayerDot" )
			if dotpnew then
				CapturePlayerVehicle(0,"OldPlTeam")

				g_Player:AddChild(dotpnew)

				dotpnew:SetPosition( pos )
				dotpnew:SetRotation(Quaternion(rot))

				ConfigureInterface("dot")
			end

			SetCameraBehindPlayerVehicle()
		</script>
	</trigger>

	<trigger	Name="trStartRobotsAttack1"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			CreateTeam("GuardTeam",1112,CVector(3393.879, 223.929, 2031.251),{"Scout02", "Fighter02"})
			CreateTeam("GuardTeam",1112,CVector(3615.844, 258.949, 1956.626),{"Scout03", "Molokovoz02"})

			AllowSave(false)

			SetVar("RobotsCount",0)

			TActivate("trRobotEntersBase")
			TActivate("trSpawnRobotsAttack")

			local dotp = getObj("DotForPlayer")
			local pos
			local rot

			if dotp then
				pos = dotp:GetPosition()
				rot = dotp:GetRotation()

				dotp:SetPosition( CVector(0, 0, 0) )
			end

			local dotpnew = CreateVehicleEx ( "Dot02", "PlayerDot", pos, "PlayerDot" )
			if dotpnew then
				CapturePlayerVehicle(0,"OldPlTeam")

				g_Player:AddChild(dotpnew)

				dotpnew:SetPosition( pos )
				dotpnew:SetRotation(Quaternion(rot))

				ConfigureInterface("dot")
			end

			SetCameraBehindPlayerVehicle()
		</script>
	</trigger>

	<trigger	Name="trStartRobotsAttack2"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			CreateTeam("GuardTeam",1112,CVector(3393.879, 223.929, 2031.251),{"Scout02", "Fighter02"})
			CreateTeam("GuardTeam",1112,CVector(3615.844, 258.949, 1956.626),{"Scout03", "Molokovoz02"})
			AllowSave(false)

			SetVar("RobotsCount",0)

			TActivate("trRobotEntersBase")
			TActivate("trSpawnRobotsAttack")

			local dotp = getObj("DotForPlayer")
			local pos
			local rot

			if dotp then
				pos = dotp:GetPosition()
				rot = dotp:GetRotation()

				dotp:SetPosition( CVector(0, 0, 0) )
			end

			local dotpnew = CreateVehicleEx ( "Dot03", "PlayerDot", pos, "PlayerDot" )
			if dotpnew then
				CapturePlayerVehicle(0,"OldPlTeam")

				g_Player:AddChild(dotpnew)

				dotpnew:SetPosition( pos )
				dotpnew:SetRotation(Quaternion(rot))

				ConfigureInterface("dot")
			end

			SetCameraBehindPlayerVehicle()
		</script>
	</trigger>

	<trigger	Name="trStartRobotsAttack3"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			CreateTeam("GuardTeam",1112,CVector(3393.879, 223.929, 2031.251),{"Scout02", "Fighter02"})
			CreateTeam("GuardTeam",1112,CVector(3615.844, 258.949, 1956.626),{"Scout03", "Molokovoz02"})

			AllowSave(false)

			SetVar("RobotsCount",0)

			TActivate("trRobotEntersBase")
			TActivate("trSpawnRobotsAttack")

			local dotp = getObj("DotForPlayer")
			local pos
			local rot

			if dotp then
				pos = dotp:GetPosition()
				rot = dotp:GetRotation()

				dotp:SetPosition( CVector(0, 0, 0) )
			end

			local dotpnew = CreateVehicleEx ( "Dot04", "PlayerDot", pos, "PlayerDot" )
			if dotpnew then
				CapturePlayerVehicle(0,"OldPlTeam")

				g_Player:AddChild(dotpnew)

				dotpnew:SetPosition( pos )
				dotpnew:SetRotation(Quaternion(rot))

				ConfigureInterface("dot")
			end

			SetCameraBehindPlayerVehicle()
		</script>
	</trigger>

	<trigger	Name="trSpawnRobotsAttack"	active="0">
		<event	timeout="2"		eventid="GE_TIME_PERIOD" />
		<script>
--		    	trigger:Deactivate()

			local stat = GetVar("RobotsCount").AsInt

			if 10>stat then
				local roblist = {"NoDrop_Robot4_2SMALL","NoDrop_Robot4SMALL","NoDrop_RobotBobot01"}
				for i=1,9 do

					local rb = getObj("RobotToBase"..i)

					if rb==nil then
						local j = ceil(i/3)
						local rbteam = CreateCaravanTeam("RobotToBase"..i,1118,CVector(getPos("SpawnRobot2_"..i	.."_loc")), {roblist[random(3)]})
						stat = stat + 1
						if rbteam then
							local veh=rbteam:GetVehicle(0)
							if veh then
								veh:SetExternalPathByName("Robot"..j.."_ExPath")
								veh:SetReactingOnDisturbingVehicles(false)
							end
						end
					end
				end
				SetVar("RobotsCount", stat)
			else
				TActivate("trRobotLiveCount")
				trigger:Deactivate()
			end

		</script>
	</trigger>

	<trigger	Name="trRobotEntersBase"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="RobotEnterBase_loc" />
		<script>
			trigger:Deactivate()

			FailQuest("r5m2_KillRobotsWithDot_Quest")

			SpawnMessageBox(8803)
			ShowDeathMenu()
		</script>
	</trigger>

	<trigger	Name="trRobotLiveCount"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
			local stat=0

		    	for i=1,9 do
				if getObj("RobotToBase"..i) then
					stat= stat  + 1
				end
			end

			if stat == 0 then
				trigger:Deactivate()
				TActivate("trEndRobotsAttack")
			end
		</script>
	</trigger>

	<trigger	Name="trEndRobotsAttack"	active="0">
		<event	timeout="0.5"		eventid="GE_TIME_PERIOD" />
		<script>
		    	trigger:Deactivate()

				local town = GetEntityByName ("TheOneEyeBase")
			    if town then
				    town:SetOpenGateToPlayer(false)
				    town:SetRuined(true)
			    end

		    	CompleteQuest("r5m2_KillRobotsWithDot_Quest")

				AllowSave(true)

		    	TActivate("cinAfterDot")

		    	local listofpos = {CVector(getPos("CaravanV1_loc")),CVector(getPos("CaravanV2_loc")),CVector(getPos("CaravanV3_loc")),CVector(getPos("CaravanV4_loc")),CVector(getPos("CaravanV5_loc"))}

		    	local oeteam = CreateTeam("OneEyeTeam", 1112, listofpos, {"r2m1_scout01","r1m1_CaravanBug01","r1m1_CaravanBug02","r2m1_scout02"}, nil , nil, Quaternion(0.036, -0.661, 0.038, 0.748))

		    	if oeteam then
				for i=0,3 do
			    		veh=oeteam:GetVehicle(i)
			    		if veh then
						veh:setGodMode(1)
					end
			    end
			else
				LOG("TRIGGER ERROR: Can't create OneEyeTeam")
			end
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trGonnaGetCaravan"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="BattleWithCaravan_loc" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_MoveToOneeyeCaravans_Quest")

			local oeteam=getObj("OneEyeTeam")

			if oeteam then
				for i=0,3 do
			    		veh=oeteam:GetVehicle(i)
			    		if veh then
						veh:setGodMode(0)
					end
			    end
		   	end

		   	TActivate("trOneEyeTeamDie")

		  	SetTolerance(1100, 1112, RS_ENEMY)

			TActivate("cinGoneGetCaravan")
		</script>
	</trigger>




<!--  -->
	<trigger Name="trOneEyeTeamDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="OneEyeTeam" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_GetAllMovies_Quest")

		   	TActivate("cinFinal")
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trExitToR5M1" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="ToR5M1" />
		<script>
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			local b = SpawnMessageBox(8801)
			if b == 1 then
				PassToMap("r5m1", "FromR5M2", -1 )

				GetPlayerVehicle():AddModifier( "fuel", "- "..random(0.5*GetPlayerFuel()) )
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				Fly("ExitTo51Return", CINEMATIC_NO_AIM, 0, 4, 1,1)
				StartCinematic()

				TActivate("trNoExit51_FadeIn")
				TActivate("RolikENDExitToMap51")
			end
 		</script>
	</trigger>
	<trigger	Name="trNoExit51_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			trigger:Deactivate()

			setPos(GetPlayerVehicle(), CVector(getPos("FromR5M1")))

			RuleConsole("g_postEffect NoiseOn")

			GetPlayerVehicle():SetRotation(Quaternion(0.091, -0.136, 0.024, 0.986))
			GetPlayerVehicle():SetExternalPathByName("ReturnPath")
 		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap51" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			trigger:Deactivate()

			RuleConsole("g_postEffect NoiseOff")

			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()
		</script>
	</trigger>




<!--  -->
	<trigger Name="triggerExitToMap62" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR6M2" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			local b = SpawnMessageBox(8801)
			if b == 1 then
				PassToMap("r6m2", "FromR5M2", -1 )
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(1, 0, 25, 1, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("RolikExitToMap62")
				TActivate ("RolikENDExitToMap62")
			end
 		</script>
	</trigger>
	<trigger Name="RolikExitToMap62" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			trigger:Deactivate() 

			RuleConsole("g_postEffect NoiseOn")

			RotationPlayerByPoints(CVector(getPos("ToR6M2")), CVector(getPos("FromR6M2")))
			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("FromR6M2")))
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap62" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			trigger:Deactivate()

			RuleConsole("g_postEffect NoiseOff")

			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()
		</script>
	</trigger>





<!--  -->
	<trigger	Name="trPlemannikQuestTimer"	active="0">
		<event	timeout="10"		eventid="GE_TIME_PERIOD" />
		<script>
		    trigger:Deactivate()

		    SetVar("PlemmanikStat", 1)
		</script>
	</trigger>


<!--  -->
	<trigger	Name="trCreateUncleDefenders"	active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="UncleRodstvennik_loc" />
		<script>
			trigger:Deactivate()

			CompleteQuest("r5m2_KillUncle_Start")

			local undefteam1 = CreateTeam("UncleDefTeam1", 1106, CVector(getPos("UncleDefenders1_loc")), {"Fighter01","Scout01"}, nil , nil, Quaternion(0, 0, 0, 1))
		   	local undefteam2 = CreateTeam("UncleDefTeam2", 1106, CVector(getPos("UncleDefenders2_loc")), {"Scout02","Scout01"}, nil , nil, Quaternion(0, 0, 0, 1))
		    	local undefteam3 = CreateTeam("UncleDefTeam3", 1106, CVector(getPos("UncleDefenders3_loc")), {"Scout03","Scout02"}, nil , nil, Quaternion(0, 0, 0, 1))
			local unleteam   = CreateTeam("UncleTeam", 1106, CVector(getPos("Uncle_loc")), {"Fighter01"}, nil , nil, Quaternion(0, 0, 0, 1))	

		    	if unleteam then
				for i=0,0 do
					veh=unleteam:GetVehicle(i)
			    		if veh then
						veh:setGodMode(1)
					end
			    	end
			else
				LOG("Can't create Uncle")
		   	end

		   	SetVar("UncleDefCount",0)

		   	TActivate("trUncleDefDie")
		</script>
	</trigger>




<!--  -->
	<trigger Name="trUncleDefDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="UncleDefTeam1" />
		<event eventid="GE_OBJECT_DIE" ObjName="UncleDefTeam2" />
		<event eventid="GE_OBJECT_DIE" ObjName="UncleDefTeam3" />
		<script>
			local stat = GetVar("UncleDefCount").AsInt+1

            	SetVar("UncleDefCount",stat)

            	if stat>=3 then
				trigger:Deactivate()

				CompleteQuest("r5m2_KillUncle_Defenders")

				local unleteam=getObj("UncleTeam")

			    	if unleteam then
					for i=0,1 do
				    		veh=unleteam:GetVehicle(i)
				    		if veh then
							veh:setGodMode(0)
						end
						TActivate("trUncleDie")
				    end
			   	end
			end
		</script>
	</trigger>

	<trigger Name="trUncleDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="UncleTeam" />
		<script>
			trigger:Deactivate()

	        	CompleteQuest("r5m2_KillUncle_Main")
		</script>
	</trigger>

	<trigger	Name="trStartGonka"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			CreateTeam("SpeedyRacer1",1111,CVector(1457.802, 281.587, 1905.100),{"DemoUral3"})

			local veh = GetEntityByName("SpeedyRacer1_vehicle_0")
			if veh then
			    veh:setGodMode(1)
				veh:SetCruisingSpeed(160)
				veh:SetExternalPathByName("Race_m0")
				veh:SetReactingOnDisturbingVehicles(false)
			end

			TActivate("triggerYouWin1")
			TActivate("triggerYouLose1")

		</script>
	</trigger>

	<trigger Name="triggerYouWin1" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="RaceFinish_loc" />
		<script>
			trigger:Deactivate()

   			CompleteQuest( "r5m2_MoveFirstToVillage" )

			local veh = GetEntityByName("SpeedyRacer1_vehicle_0")
			if veh then
			    veh:Remove()
			end			   

			TActivate ("cinYouWin1")
			TDeactivate ("triggerYouLose1")
		</script>
	</trigger>

	<trigger Name="triggerYouLose1" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="SpeedyRacer1" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="RaceFinishSopernik_loc" />
		<script>
			trigger:Deactivate()

   			FailQuest( "r5m2_MoveFirstToVillage" )

			local veh = GetEntityByName("SpeedyRacer1_vehicle_0")
			if veh then
			    veh:Remove()
			end

			TActivate ("cinYouLose1")
			TDeactivate ("triggerYouWin1")
		</script>
	</trigger>


	<trigger	Name="trCreateOptBandit"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			trigger:Deactivate()

			local unleteam   = CreateTeam("OptBandTeam", 1106, CVector(getPos("SpawnOptBandit_loc")), {"Molokovoz01"}, nil , nil, Quaternion(0, 0, 0, 1))	
	        	TActivate("trOptBandTeamDie")
		</script>
	</trigger>

	<trigger Name="trOptBandTeamDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="OptBandTeam" />
		<script>
			trigger:Deactivate()
			CompleteQuest("r5m2_KillBantits")
		</script>
	</trigger>


	<trigger	Name="trFindKlad"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FindSomething_loc" />
		<script>
			trigger:Deactivate()
	        	CompleteQuest("r5m2_FindKlad")
		</script>
	</trigger>

	<trigger	Name="trWowVehicle"	active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearWowVeh_loc" />
		<script>
			trigger:Deactivate()
			local wowveh = CreateCaravanTeam("WowVehTeam", 1105, CVector(getPos("SpawnWowVeh_loc")), {"Scout01"}, nil, nil)
		 	if wowveh then
			   local veh = wowveh:GetVehicle(0)
		 	   if  veh then
					veh:SetRotation(Quaternion(0.047, 0.392, -0.037, 0.918))
					veh:SetThrottle(1)
					veh:SetCustomLinearVelocity( 50 )
					veh:SetExternalPathByName("WowVeeh_ExPath")
		 	   end
			   TActivate("trBoomWowVeh")
		 	end
		</script>
	</trigger>

	<trigger	Name="trBoomWowVeh"	active="0">
		<event	timeout="3.4"		eventid="GE_TIME_PERIOD" />
		<script>
		    trigger:Deactivate()

		local wowveh = getObj("WowVehTeam_vehicle_0")
		if wowveh then
			wowveh:AddModifier("hp","= -100")
		end
		</script>
	</trigger>

	<trigger	Name="trTime"	active="0">
		<event	timeout="10"		eventid="GE_TIME_PERIOD" />
		<script>
		    trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="tr"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="MorassRoad_loc" />
		<script>
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger Name="trLeaderCaravanDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="LeaderGuardTeam" />
		<script>
			trigger:Deactivate()
			</script>
	</trigger>

	<trigger	Name="PervomaykaBurned"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if IsQuestTaken("r5m1_KillBoss4_Quest") then
				trigger:Deactivate()

			    local burn = GetEntityByName ("FIRE01")
			    if burn then 
			        burn:Remove() 
			    end

			    local burn = GetEntityByName ("FIRE02")
			    if burn then 
			        burn:Remove() 
			    end

			    local burn = GetEntityByName ("FIRE03")
			    if burn then 
			        burn:Remove() 
			    end

			    local burn = GetEntityByName ("FIRE04")
			    if burn then 
			        burn:Remove() 
			    end

			    local burn = GetEntityByName ("FIRE05")
			    if burn then 
			        burn:Remove() 
			    end

			    local burn = GetEntityByName ("FIRE06")
			    if burn then 
			        burn:Remove() 
			    end    

				local burn = GetEntityByName ("FIRE07")
			    if burn then 
			        burn:Remove() 
			    end 

				local burn = GetEntityByName ("FIRE08")
			    if burn then 
			        burn:Remove() 
			    end     	
            end

		</script>
	</trigger>	
</triggers>